# Telegram Бот для InfinityAgent

Telegram бот, который интегрируется с mcp-client для обработки запросов пользователей.

## Основные возможности

- Авторизация и регистрация пользователя через Telegram
- Отправка запросов к бэкенду
- Сохранение истории сообщений в PostgreSQL
- Просмотр истории сообщений

## Требования

- Python 3.9+
- PostgreSQL (для хранения сообщений и данных пользователей)
- Запущенный mcp-client на порту 8000

## Установка

1. Создайте виртуальное окружение и активируйте его:
```bash
python -m venv venv
# Windows
venv\Scripts\activate
# Linux/Mac
source venv/bin/activate
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Настройте переменные окружения:
   Создайте файл `.env` в папке `tg_bot` со следующими параметрами:
```
TELEGRAM_TOKEN=ваш_токен_телеграм_бота
POSTGRES_USER=пользователь_базы_данных
POSTGRES_PASSWORD=пароль_базы_данных
POSTGRES_DB=имя_базы_данных
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
```

## Запуск

### 1. Запуск MCP-клиента

Сначала необходимо запустить MCP-клиент. Перейдите в папку `mcp-client` и запустите:

```bash
cd ../mcp-client
python -m api.main
```

Это запустит HTTP API на порту 8000, который будет использоваться Telegram ботом.

### 2. Запуск Telegram бота

```bash
cd ../tg_bot
python main.py
```

## Архитектура

Система состоит из следующих компонентов:

1. **Telegram бот** - интерфейс для взаимодействия с пользователями
2. **MCP-клиент** - бэкенд для обработки запросов и генерации ответов
3. **База данных PostgreSQL** - хранение истории сообщений и данных пользователей

### Процесс обработки запроса:

1. Пользователь отправляет сообщение в Telegram боте
2. Бот сохраняет сообщение в базе данных
3. Бот отправляет запрос в MCP-клиент через HTTP API
4. MCP-клиент обрабатывает запрос и возвращает ответ
5. Бот получает ответ, сохраняет его в базе данных и отправляет пользователю

## Структура кода

- `main.py` - Основной файл Telegram бота
- `backend_client.py` - Клиент для взаимодействия с MCP-клиентом
- `database.py` - Функции для работы с базой данных
- `config.py` - Конфигурация и настройки

## Добавление новых функций

Для добавления новых функций в Telegram бота:

1. Добавьте новые обработчики команд в `main.py`
2. При необходимости, расширьте `backend_client.py` для взаимодействия с новыми API MCP-клиента
3. Обновите схему базы данных в `database.py` при необходимости

## Команды Telegram бота

- `/start` - Начать работу с ботом
- `/help` - Показать справку с доступными командами
- `/history` - Показать историю сообщений

## База данных

В проекте используется PostgreSQL для хранения пользователей и истории сообщений. Схема базы данных создается автоматически при первом запуске.
